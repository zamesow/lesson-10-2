<!-- Создание app-server, бэкенд на Node.js
Его задача - слушать входящие соединения, рендерить html и отдавать пользователю

1. npm install express
    - Если server - это дом (предоставляется провайдером) с подъездами и квартирами, то web-server - это консъерж, а app-server - это одна квартира (которую мы заселим нашим приложением), запустим на каком-нибудь порте
2. app.js - запускаем express и устанавливаем порт
3. Node app.js - даную команду изменим в script
    Application server is running on port 4444
4. Мы запустили в кв. жильцов, но они не умеют нам отвечать, поэтому намнужно добавить маршруты app.get()
    запуская localhost:4444/ и localhost:4444/about видим:
    Это колбек для app.get("/")
    Это колбек для app.get("/about")
5. Добавив в параметры колбека (req, res), а в вывод console.log(req.url); увидим:
    /
    /about
6. Так же можем что-то отправить res.send() в виде объекта или массива и получим json
    - смотрим в devops -> Network -> All -> Response и Preview
    - Пробуем отправить в виде строки из тега h1
МЫ НАУЧИЛИСЬ РЕАГИРОВАТЬ НА РАЗНЫЕ ВХОДЯЩИЕ СОЕДИНЕНИЯ
-------------------------------------------------

7. Устанавливаем handlebars - A Step By Step Guide To Using Handlebars With Your Node js App
    npm install express-handlebars --save

8. для простой раздачи статических файлов без handlebars регистрируем папку public, кидаем туда папку images с нашей картинкой (index.html мы будем рендерить по шаблону)
    - делаем тег h1
    - читаем гайд и видим, что для //serves static files yflj зарегистрировать мидлбар app.use(express.static('public')) - пишем в наш app.js
    - создаём так же папки stylesheets, javascripts
    - делаем в корне папку views/layouts - для переиспользования <head>, <body>...
9. По-умолчанию express использует шаблонизатор PAG, для перерегистрации на handlebars нужно указать, чтобы он своим движком его использовал, пишем в app.js: app.set('view engine', 'hbs'); hbs - просто переменная
    - а так же нужно сконфигурировать handlebars: app.engine('hbs', exhbs());
    - а во внутрь ф-ции можно передать настройки исходящего названия {extname: 'hbs',}
    - создаём views/home.hbs и about.hbs, а в них стандарный код html ! и определение, что за страница?
10. В наши маршруты app.get прописываем определители res.render('home') и about и перезапускаем сервер
    - может затребовать views/layouts/main.hbs из-за повторяющегося кода "!" в наших двух шаблонах. Сделаем:
    - создаём main.hbs -> !,
        - в <title> пишем "Это layout из main.hbs"
        - в <body> пишем {{{body}}} - теперь в других шаблонах можно стереть всё и просто вписать то, что заменится в {{{body}}}, к примеру:
    в home.hbs: <h1>Это домашняя страница</h1> [Это то же самое, что написать res.send('home', { layout: 'main' });]
    в about.hbs: <h1>Это страница "О нас"</h1> [Это то же самое, что написать res.send('about', { layout: 'about' });]
    - перезапускаем
------------------------------------------------------

11. Создаём шаблон products.hbs
    - добавляем в app.js новый app.get() и res.render для products
12. Чтоб постоянно не перезапускать сервер при изменении наших файлов устанавливаем пакет npm i nodemon -D и меняем в script "node app.js" на "nodemon app.js"
    - перезапускаем на /products...
13. вставляем в products.hbs данные карточек товаров из урока HTML Методология БЭМ, т.к. li должны быть динамическими, оставляем только одну
    - продукты будем брать из products.json, импортируем его
    - в вызов res.render передаём объект products: res.render('products', { products });
    - добавляем {{#each products}} и шаблонизируем
    - добавляем product.css (стили оттуда же) и стили body перекидываем в common.css
    - стили common.css добавляем в <link> main.hbs с адресом относительно public -> "stylesheets/common.css"
    - а стили для product ставим в link main.hbs с шаблоном "stylesheets/{{cssFileName}}.css" и в рендер через запятую "cssFileName: 'products'", то же самое можно сделать и для about
-----------------------------------------------

14. Делаем навигацию через паршал, создаём views/partials/site-nav.hbs
        - паршал {{> site-nav}} вставляем просто в <body> main.hbs
15. Делаем шаблон названий вкладок <title> {{pageTitle}} и так же через запятую в рендер для каждой страницы

ПРИ нажатии на ссылку запрос доходит до res.render и возвращает нам новый html, который рендерится на сервере и отдаётся браузеру в виде строки
-------------------------------------------------

16. Динамические параметры. (product/ - это статика, а product/0 - это динамика, т.к. вконце уникальный id продукта, указывать в коде на который будет двоеточие, например '/product/:productId')
    - Обворачиваем наши продукты в ссылку
    - req - это объект запроса, добавляем новый слушатель:
                app.get('/product/:productId', (req, res) => {
                    console.log(req.params);
                });
    - в шаблоне в нашу созданную ссылку нужно указать шаблон адреса с уникальным идентификатором, в нашем случае это <a href="/product/{{id}}"> - потому что в product.json у каждого товара уникальный идентификатор - это id
    - проверяем, куда ведёт ссылка каждого товара?
    - при нажатии на карточку в терминале пишется отзыв productId
17. можно найти по id наш продукт, записав в ф-цию :productId ф-цию сравнения:
                const product = products.find(p => p.id === req.params.productId);
18. рендерим страницу одного продукта, создав product.hbs и записав в :productId следующий рендер:
                res.render('product', { product });
    - пишем шаблон продукта
    - нажимая на один из продуктов переходим на страницу одного продукта
    - создаём ссылку "Обратно к товарам"
    - в home.hbs создаём ссылку на нашу gif

МЫ СОЗДАЛИ APP-SERVER - это бэкенд, который по шаблонам делает нам html'ки с уже готовыми:
    - css (верстальщик)
        - оптимизированный из sass
    - js (я пишу для будущих файлов), собрать его с parcel/webpack
    - оптимизированными картинками
    - нарезанными шаблонами hbs
----------------------------------------------------

19.  Деплоим вместе с git - https://devcenter.heroku.com/articles/git#prerequisites-install-git-and-the-heroku-cli
    - регистрация
    - привязка к github
    - установка Homebrew (на маке должен быть, но если нет) - /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
    - установка herocu-cli - brew tap heroku/brew && brew install heroku
    - логинимся через сайт командой -  heroku login (пробел)
    - создаём проект на хероку командой - heroku create (название проекта потом можно сменить)
    - проверяем, установлен ли ремоут для гита - git remote -v (origin - это гит на сервере гитхаб)
20. Перед тем, как деплоить нужно изменить правила по порту
    20.1. - порт на хероку будет выдаваться произвольно, неизвестно какой, поэтому прописываем условие в app.js:
        const PORT = process.env.PORT || 4444;
        - и меняем везде 4444 на переменную PORT
    20.2. - в script дописываем команду запуска "start": "node app.js"
    - запускаем: git push heroku main:master (из нашей ветки main в их ветку master)
    - в другом терминале можно запустить команду: heroku logs --tail
-->
